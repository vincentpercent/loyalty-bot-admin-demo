{% extends "base.html" %}

{% block title %}–û—Ç–∑—ã–≤—ã ‚Äî –º–æ–¥–µ—Ä–∞—Ü–∏—è{% endblock %}

{% block content %}
<div class="space-y-6">

  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
  <div class="relative overflow-hidden bg-gradient-to-br from-royal-surface via-royal-surface to-royal-gold/5 rounded-2xl border border-royal-border p-6">
    <div class="absolute top-0 right-0 w-64 h-64 bg-gradient-to-bl from-royal-gold/10 to-transparent rounded-full -mr-32 -mt-32"></div>
    <div class="absolute bottom-0 left-0 w-48 h-48 bg-gradient-to-tr from-amber-500/5 to-transparent rounded-full -ml-24 -mb-24"></div>
    
    <div class="relative flex items-center justify-between">
      <div>
        <div class="flex items-center gap-3 mb-2">
          <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-amber-500/20 to-amber-500/5 border border-amber-500/30 flex items-center justify-center">
            <svg class="w-5 h-5 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
            </svg>
          </div>
          <div class="text-[10px] uppercase tracking-[0.22em] text-amber-400">
            –ú–æ–¥–µ—Ä–∞—Ü–∏—è
          </div>
        </div>
        <h1 class="text-2xl font-bold bg-gradient-to-r from-white to-royal-muted bg-clip-text text-transparent">
          –û—Ç–∑—ã–≤—ã –∫–ª–∏–µ–Ω—Ç–æ–≤
        </h1>
        <p class="text-sm text-royal-muted mt-2 max-w-xl">
          –ú–æ–¥–µ—Ä–∞—Ü–∏—è –∑–∞—è–≤–æ–∫ –Ω–∞ –±–æ–Ω—É—Å—ã –∑–∞ –æ—Ç–∑—ã–≤—ã –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç–∞—Ö –∏ 2–ì–ò–°
        </p>
      </div>
      <form method="get" class="flex items-center gap-3 text-sm">
        <div class="flex items-center gap-2">
          <span class="text-royal-muted text-xs uppercase tracking-[0.18em]">–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞</span>
          <select name="platform_filter"
                  onchange="this.form.submit()"
                  class="bg-royal-border/30 border border-royal-border rounded-xl px-3 py-2 text-sm text-white focus:outline-none focus:border-royal-gold transition">
            <option value="">–í—Å–µ</option>
            <option value="yandex" {% if platform_filter == 'yandex' %}selected{% endif %}>–Ø–Ω–¥–µ–∫—Å</option>
            <option value="2gis" {% if platform_filter == '2gis' %}selected{% endif %}>2–ì–ò–°</option>
          </select>
        </div>
        <div class="flex items-center gap-2">
          <span class="text-royal-muted text-xs uppercase tracking-[0.18em]">–°—Ç–∞—Ç—É—Å</span>
          <select name="status_filter"
                  onchange="this.form.submit()"
                  class="bg-royal-border/30 border border-royal-border rounded-xl px-3 py-2 text-sm text-white focus:outline-none focus:border-royal-gold transition">
            <option value="">–í—Å–µ</option>
            <option value="NEW" {% if status_filter == ReviewRequestStatus.NEW %}selected{% endif %}>–ù–æ–≤—ã–µ</option>
            <option value="CONFIRMED" {% if status_filter == ReviewRequestStatus.CONFIRMED %}selected{% endif %}>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ</option>
            <option value="REJECTED" {% if status_filter == ReviewRequestStatus.REJECTED %}selected{% endif %}>–û—Ç–∫–ª–æ–Ω—ë–Ω–Ω—ã–µ</option>
          </select>
        </div>
      </form>
    </div>
  </div>

  <div class="bg-royal-surface rounded-2xl border border-royal-border overflow-hidden">
    <div class="max-h-[70vh] overflow-auto">
      <table class="min-w-full text-sm">
        <thead class="bg-black/40 text-xs uppercase tracking-[0.18em] text-royal-muted">
          <tr class="border-b border-royal-border">
            <th class="text-left px-4 py-2">ID</th>
            <th class="text-left px-4 py-2">–§–æ—Ç–æ</th>
            <th class="text-left px-4 py-2">–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞</th>
            <th class="text-left px-4 py-2">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
            <th class="text-left px-4 py-2">–¢–µ–ª–µ—Ñ–æ–Ω</th>
            <th class="text-left px-4 py-2">–î–∞—Ç–∞</th>
            <th class="text-left px-4 py-2">–°—Ç–∞—Ç—É—Å</th>
            <th class="text-right px-4 py-2"></th>
          </tr>
        </thead>
        <tbody class="divide-y divide-royal-border/60">
        {% for r in reviews %}
          <tr id="review-row-{{ r.id }}" class="hover:bg-white/5 {% if r.user and r.user.id == top_reviewer_id %}bg-royal-gold/10 border-l-2 border-l-royal-gold{% endif %}">
            <td class="px-4 py-2 text-xs text-royal-muted">
              {{ r.id }}
            </td>
            <td class="px-4 py-2">
              <div class="relative group">
                <div class="w-16 h-16 border border-royal-border rounded-lg overflow-hidden bg-black/40 flex items-center justify-center cursor-pointer">
                  <img src="/reviews/{{ r.id }}/image"
                       alt="–°–∫—Ä–∏–Ω {{ r.id }}"
                       class="w-full h-full object-cover">
                </div>
                <!-- Popup –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ -->
                <div class="hidden group-hover:block absolute left-20 top-0 z-50 bg-royal-surface border border-royal-border rounded-xl shadow-2xl p-3 w-72">
                  <a href="/reviews/{{ r.id }}">
                    <img src="/reviews/{{ r.id }}/image"
                         alt="–°–∫—Ä–∏–Ω {{ r.id }}"
                         class="w-full h-auto rounded-lg border border-royal-border mb-3">
                  </a>
                  <div id="review-actions-{{ r.id }}">
                    {% if r.status.value == 'NEW' %}
                    <div class="flex gap-2">
                      <button type="button"
                              hx-post="/reviews/{{ r.id }}/confirm/quick"
                              hx-target="#review-row-{{ r.id }}"
                              hx-swap="outerHTML"
                              hx-confirm="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ—Ç–∑—ã–≤ –∏ –Ω–∞—á–∏—Å–ª–∏—Ç—å –±–æ–Ω—É—Å?"
                              class="flex-1 px-3 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-500 text-white text-xs font-medium transition">
                        ‚úì –ü—Ä–∏–Ω—è—Ç—å
                      </button>
                      <button type="button"
                              hx-post="/reviews/{{ r.id }}/reject/quick"
                              hx-target="#review-row-{{ r.id }}"
                              hx-swap="outerHTML"
                              hx-confirm="–û—Ç–∫–ª–æ–Ω–∏—Ç—å –æ—Ç–∑—ã–≤?"
                              class="flex-1 px-3 py-2 rounded-lg bg-red-600 hover:bg-red-500 text-white text-xs font-medium transition">
                        ‚úï –û—Ç–∫–ª–æ–Ω–∏—Ç—å
                      </button>
                    </div>
                    {% else %}
                    <div class="text-center text-xs text-royal-muted">
                      {% if r.status.value == 'CONFIRMED' %}
                        <span class="text-emerald-400">‚úì –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ</span>
                      {% else %}
                        <span class="text-red-400">‚úï –û—Ç–∫–ª–æ–Ω–µ–Ω–æ</span>
                      {% endif %}
                    </div>
                    {% endif %}
                  </div>
                </div>
              </div>
            </td>
            <td class="px-4 py-2 text-xs">
              {% if r.platform == '2gis' %}
                <span class="px-2 py-0.5 rounded-full bg-green-500/10 text-green-300 border border-green-500/40">
                  2–ì–ò–°
                </span>
              {% else %}
                <span class="px-2 py-0.5 rounded-full bg-blue-500/10 text-blue-300 border border-blue-500/40">
                  –Ø–Ω–¥–µ–∫—Å
                </span>
              {% endif %}
            </td>
            <td class="px-4 py-2">
              <div class="flex flex-col">
                <span class="text-sm flex items-center gap-1">
                  {% if r.user %}
                    {{ r.user.full_name or r.user.username or ('TG:' ~ r.telegram_user_id) }}
                    {% if r.user.id == top_reviewer_id %}
                      <span class="text-royal-gold" title="–õ–∏–¥–µ—Ä –ø–æ –æ—Ç–∑—ã–≤–∞–º">üëë</span>
                    {% endif %}
                  {% else %}
                    {{ 'TG:' ~ r.telegram_user_id }}
                  {% endif %}
                </span>
                <span class="text-xs text-royal-muted">
                  TG ID: {{ r.telegram_user_id }}
                </span>
              </div>
            </td>
            <td class="px-4 py-2 text-sm">
              {{ r.phone or '‚Äî' }}
            </td>
            <td class="px-4 py-2 text-xs text-royal-muted">
              {{ r.created_at.strftime('%d.%m.%Y %H:%M') if r.created_at else '‚Äî' }}
            </td>
            <td class="px-4 py-2 text-xs">
              {% if r.status.value == "NEW" %}
                <span class="px-2 py-0.5 rounded-full bg-yellow-500/10 text-yellow-300 border border-yellow-500/40">
                  –ù–æ–≤–∞—è
                </span>
              {% elif r.status.value == "CONFIRMED" %}
                <span class="px-2 py-0.5 rounded-full bg-emerald-500/10 text-emerald-300 border border-emerald-500/40">
                  –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ
                </span>
              {% else %}
                <span class="px-2 py-0.5 rounded-full bg-red-500/10 text-red-300 border border-red-500/40">
                  –û—Ç–∫–∞–∑–∞–Ω–æ
                </span>
              {% endif %}
            </td>
            <td class="px-4 py-2 text-right">
              <a href="/reviews/{{ r.id }}"
                 class="text-[11px] px-3 py-1.5 rounded-lg border border-royal-border hover:border-royal-gold text-royal-muted hover:text-royal-gold uppercase tracking-[0.18em] transition">
                –û—Ç–∫—Ä—ã—Ç—å
              </a>
            </td>
          </tr>
        {% else %}
          <tr>
            <td colspan="8" class="px-4 py-6 text-center text-sm text-royal-muted">
              –ó–∞—è–≤–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç.
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

</div>
{% endblock %}

